---
// Philosophy concepts that define DOJO
const concepts = [
  {
    japanese: "変革",
    romanji: "Henkaku",
    english: "Transformation",
    description: "Every journey begins with a decision to change. When you enter DOJO, you commit to transforming not just your body, but your entire approach to excellence."
  },
  {
    japanese: "強さ",
    romanji: "Tsuyosa",
    english: "Strength",
    description: "Physical strength builds mental fortitude. Through deliberate practice and progressive overload, we forge unbreakable will."
  },
  {
    japanese: "均衡",
    romanji: "Kinkou",
    english: "Balance",
    description: "True power comes from harmony - between effort and recovery, individual goals and collective success, ambition and discipline."
  },
  {
    japanese: "共同体",
    romanji: "Kyoudoutai",
    english: "Community",
    description: "Iron sharpens iron. We rise together, pushing each other beyond perceived limits while building bonds that extend far beyond the training floor."
  },
  {
    japanese: "闘志",
    romanji: "Toushi",
    english: "Fighting Spirit",
    description: "The warrior's mindset - unwavering determination in the face of adversity. Every challenge is an opportunity to prove your resolve."
  },
  {
    japanese: "卓越",
    romanji: "Takuetsu",
    english: "Excellence",
    description: "The outcome of transformation. Excellence isn't an act but a habit, forged through strength, balance, community, and fighting spirit. This is what you take to the world – the execution of everything you've built at DOJO."
  }
];
---

<div class="philosophy-carousel relative max-w-6xl mx-auto">
  <div class="carousel-container overflow-hidden">
    <div class="philosophy-carousel-track carousel-track flex transition-transform duration-500 ease-in-out">
      {concepts.map((concept, index) => (
        <div class="philosophy-carousel-slide carousel-slide min-w-full px-4 md:px-6" data-slide={index}>
          <div class="bg-white rounded-lg pt-12 pb-8 px-8 md:pt-16 md:pb-12 md:px-12 text-center shadow-lg relative overflow-visible">
            <div class="mb-6">
              <div class="japanese-tooltip-wrapper relative inline-block mb-2">
                <div class="text-6xl md:text-8xl font-bold text-dojo-red block cursor-help">
                  {concept.japanese}
                </div>
                <span class="japanese-tooltip">{concept.romanji}</span>
              </div>
              <div class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-inter font-bold text-dojo-black italic">
                "{concept.english}"
              </div>
            </div>
            <p class="text-lg text-dojo-gray max-w-3xl mx-auto">
              {concept.description}
            </p>
          </div>
        </div>
      ))}
    </div>
  </div>
  
  <!-- Navigation -->
  <button 
    class="carousel-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-12 bg-white/80 hover:bg-white text-dojo-black shadow-lg p-3 rounded-full transition-colors"
    aria-label="Previous concept"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>
  
  <button 
    class="carousel-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-12 bg-white/80 hover:bg-white text-dojo-black shadow-lg p-3 rounded-full transition-colors"
    aria-label="Next concept"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </button>
  
  <!-- Indicators -->
  <div class="flex justify-center space-x-2 mt-8">
    {concepts.map((_, index) => (
      <button 
        class={`carousel-indicator w-2 h-2 rounded-full transition-all ${
          index === 0 ? 'bg-dojo-red w-8' : 'bg-dojo-gray'
        }`}
        data-slide-to={index}
        aria-label={`Go to slide ${index + 1}`}
      ></button>
    ))}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Find the philosophy carousel container specifically
    const carouselContainer = document.querySelector('.philosophy-carousel');
    if (!carouselContainer) {
      console.error('Philosophy carousel container not found');
      return;
    }
    
    const track = carouselContainer.querySelector('.philosophy-carousel-track');
    const slides = carouselContainer.querySelectorAll('.philosophy-carousel-slide');
    const prevButton = carouselContainer.querySelector('.carousel-prev');
    const nextButton = carouselContainer.querySelector('.carousel-next');
    const indicators = carouselContainer.querySelectorAll('.carousel-indicator');
    
    if (!track || !slides.length) {
      console.error('Carousel elements not found');
      return;
    }
    
    let currentSlide = 0;
    const totalSlides = slides.length;
    let autoAdvanceInterval = null;
    
    // Use the concepts array length as the source of truth (should be 6)
    const expectedSlides = 6;
    if (totalSlides !== expectedSlides) {
      console.warn(`Found ${totalSlides} slides but expected ${expectedSlides}. Using ${expectedSlides}.`);
    }
    const actualTotalSlides = Math.min(totalSlides, expectedSlides);
    
    function resetAutoAdvance() {
      if (autoAdvanceInterval !== null) {
        clearInterval(autoAdvanceInterval);
      }
      autoAdvanceInterval = setInterval(() => {
        currentSlide = (currentSlide + 1) % actualTotalSlides;
        goToSlide(currentSlide, false); // false = don't reset timer (it's already running)
      }, 6000);
    }
    
    function goToSlide(index, resetTimer = true) {
      // Wrap around
      if (index < 0) {
        index = actualTotalSlides - 1;
      } else if (index >= actualTotalSlides) {
        index = 0;
      }
      
      currentSlide = index;
      track.style.transform = `translateX(-${currentSlide * 100}%)`;
      
      indicators.forEach((indicator, i) => {
        if (i === currentSlide) {
          indicator.classList.add('bg-dojo-red', 'w-8');
          indicator.classList.remove('bg-dojo-gray');
        } else {
          indicator.classList.remove('bg-dojo-red', 'w-8');
          indicator.classList.add('bg-dojo-gray');
        }
      });
      
      // Reset auto-advance timer after manual navigation
      if (resetTimer) {
        resetAutoAdvance();
      }
    }
    
    function nextSlide() {
      currentSlide = (currentSlide + 1) % actualTotalSlides;
      goToSlide(currentSlide, true); // true = reset timer
    }
    
    function prevSlide() {
      currentSlide = (currentSlide - 1 + actualTotalSlides) % actualTotalSlides;
      goToSlide(currentSlide, true); // true = reset timer
    }
    
    prevButton?.addEventListener('click', prevSlide);
    nextButton?.addEventListener('click', nextSlide);
    
    indicators.forEach((indicator, index) => {
      if (index < actualTotalSlides) {
        indicator.addEventListener('click', () => {
          goToSlide(index, true); // true = reset timer
        });
      }
    });
    
    // Start auto-advance
    resetAutoAdvance();
  });
</script>

<style>
  /* Japanese tooltip */
  .japanese-tooltip-wrapper {
    position: relative;
  }
  
  .japanese-tooltip {
    position: absolute;
    bottom: calc(100% + 0.75rem);
    left: 50%;
    transform: translateX(-50%);
    background-color: #1a1a1a;
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-style: italic;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 20;
  }
  
  .japanese-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1a1a1a;
  }
  
  .japanese-tooltip-wrapper:hover .japanese-tooltip {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  
  @media (max-width: 768px) {
    .carousel-prev {
      transform: translateY(-50%) translateX(1rem);
    }
    
    .carousel-next {
      transform: translateY(-50%) translateX(-1rem);
    }
    
    .japanese-tooltip {
      font-size: 0.75rem;
      padding: 0.375rem 0.5rem;
    }
  }
</style>
