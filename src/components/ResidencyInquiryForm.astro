---
// Residency inquiry form
import { formspreeUrls } from '../config/formspree.js';
---

<form id="residency-inquiry-form" action={formspreeUrls.residency} method="POST" class="max-w-xl mx-auto">
  <!-- Required Fields -->
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
    <div>
      <label for="residency-first-name" class="block text-sm font-medium text-white">
        First Name <span class="text-dojo-light">*</span>
      </label>
      <input
        type="text"
        name="first-name"
        id="residency-first-name"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div>
      <label for="residency-last-name" class="block text-sm font-medium text-white">
        Last Name <span class="text-dojo-light">*</span>
      </label>
      <input
        type="text"
        name="last-name"
        id="residency-last-name"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="residency-email" class="block text-sm font-medium text-white">
        Email <span class="text-dojo-light">*</span>
      </label>
      <input
        type="email"
        name="email"
        id="residency-email"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="residency-phone" class="block text-sm font-medium text-white">
        Phone Number <span class="text-dojo-light text-xs">(optional)</span>
      </label>
      <input
        type="tel"
        name="phone"
        id="residency-phone"
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="residency-company" class="block text-sm font-medium text-white">
        Company / Organization <span class="text-dojo-light text-xs">(optional)</span>
      </label>
      <input
        type="text"
        name="company"
        id="residency-company"
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="residency-interest" class="block text-sm font-medium text-white">
        Tell us why you're reaching out <span class="text-dojo-light">*</span>
      </label>
      <textarea
        id="residency-interest"
        name="interest"
        rows="4"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
        placeholder="Are you interested in Startup Studio or Company Residency? Tell us about your venture or company and what you're looking for..."
      ></textarea>
    </div>
  </div>
  
  <!-- Optional Detailed Section -->
  <div class="mt-8 pt-8 border-t border-white/20">
    <button
      type="button"
      id="toggle-residency-details"
      class="w-full flex items-center justify-between text-left p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-colors group"
    >
      <div>
        <div class="text-sm font-medium text-white mb-1">Want to be more specific?</div>
        <div class="text-xs text-dojo-light">Share details about your venture, team size, space needs, and more</div>
      </div>
      <svg
        id="toggle-residency-icon"
        class="w-5 h-5 text-white transform transition-transform"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>
    
    <div id="residency-details-section" class="hidden mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2">
      <div class="sm:col-span-2">
        <label for="residency-type" class="block text-sm font-medium text-white">
          Residency Type <span class="text-dojo-light text-xs">(optional)</span>
        </label>
        <select
          id="residency-type"
          name="residency-type"
          class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white focus:border-dojo-red focus:ring-dojo-red"
        >
          <option value="">Select a residency type...</option>
          <option value="startup-studio">Startup Studio</option>
          <option value="company-residency">Company Residency</option>
          <option value="not-sure">Not Sure Yet</option>
        </select>
      </div>
      
      <div class="sm:col-span-2">
        <label for="residency-team-size" class="block text-sm font-medium text-white">
          Team Size <span class="text-dojo-light text-xs">(optional)</span>
        </label>
        <input
          type="number"
          name="team-size"
          id="residency-team-size"
          min="1"
          placeholder="Number of team members"
          class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
        />
      </div>
      
      <div class="sm:col-span-2">
        <label for="residency-space-needs" class="block text-sm font-medium text-white">
          Space Needs <span class="text-dojo-light text-xs">(optional)</span>
        </label>
        <select
          id="residency-space-needs"
          name="space-needs"
          class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white focus:border-dojo-red focus:ring-dojo-red"
        >
          <option value="">Select space needs...</option>
          <option value="hot-desk">Hot Desk</option>
          <option value="dedicated-desk">Dedicated Desk</option>
          <option value="private-office">Private Office</option>
          <option value="meeting-room">Meeting Room Access</option>
          <option value="flexible">Flexible / Not Sure</option>
        </select>
      </div>
      
      <div class="sm:col-span-2">
        <label for="residency-stage" class="block text-sm font-medium text-white">
          Stage <span class="text-dojo-light text-xs">(optional)</span>
        </label>
        <select
          id="residency-stage"
          name="stage"
          class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white focus:border-dojo-red focus:ring-dojo-red"
        >
          <option value="">Select stage...</option>
          <option value="idea">Idea Stage</option>
          <option value="mvp">MVP / Prototype</option>
          <option value="early-revenue">Early Revenue</option>
          <option value="growth">Growth Stage</option>
          <option value="established">Established Company</option>
        </select>
      </div>
      
      <div class="sm:col-span-2">
        <label for="residency-details" class="block text-sm font-medium text-white">
          Additional Details <span class="text-dojo-light text-xs">(optional)</span>
        </label>
        <textarea
          id="residency-details"
          name="details"
          rows="4"
          class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
          placeholder="Funding status, timeline, special requirements, etc."
        ></textarea>
      </div>
    </div>
  </div>
  
  <div class="mt-6">
    <button
      type="submit"
      class="w-full bg-dojo-red text-white py-3 px-6 rounded font-semibold hover:bg-red-700 transition-colors"
    >
      Submit Residency Inquiry
    </button>
  </div>
  
  <p class="text-sm text-dojo-light mt-4 text-center">
    We'll review your inquiry and get back to you within 2-3 business days.
  </p>
  
  <div id="residency-form-message" class="mt-4 hidden">
    <div class="rounded-md p-4 bg-white/10 border border-white/20">
      <p class="text-sm text-white"></p>
    </div>
  </div>
</form>

<script define:vars={{ formspreeUrl: formspreeUrls.residency }}>
  // Toggle details section
  const toggleButton = document.getElementById('toggle-residency-details');
  const detailsSection = document.getElementById('residency-details-section');
  const toggleIcon = document.getElementById('toggle-residency-icon');
  
  toggleButton?.addEventListener('click', () => {
    const isHidden = detailsSection?.classList.contains('hidden');
    if (isHidden) {
      detailsSection?.classList.remove('hidden');
      toggleIcon?.classList.add('rotate-180');
    } else {
      detailsSection?.classList.add('hidden');
      toggleIcon?.classList.remove('rotate-180');
    }
  });
  
  // Form submission
  const form = document.getElementById('residency-inquiry-form') as HTMLFormElement;
  const formMessage = document.getElementById('residency-form-message');
  const messageText = formMessage?.querySelector('p');
  const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;
  
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!form || !formMessage || !messageText) return;
    
    // Disable submit button to prevent double submissions
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.textContent = 'Submitting...';
    }
    
    const formData = new FormData(form);
    
    try {
      const response = await fetch(formspreeUrl, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });
      
      if (response.ok) {
        // Success
        formMessage.classList.remove('hidden');
        const messageDiv = formMessage.querySelector('div');
        if (messageDiv) {
          messageDiv.className = 'rounded-md p-4 bg-green-500/20 border border-green-500/50';
        }
        messageText.className = 'text-sm text-green-300 text-center';
        messageText.textContent = 'Thank you for your inquiry. We\'ll review your request and get back to you within 2-3 business days.';
        
        // Reset form
        form.reset();
        
        // Collapse details section
        detailsSection?.classList.add('hidden');
        toggleIcon?.classList.remove('rotate-180');
        
        // Scroll to message
        formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        // Error from Formspree
        const data = await response.json();
        throw new Error(data.error || 'Something went wrong. Please try again.');
      }
    } catch (error) {
      // Network error or other error
      formMessage.classList.remove('hidden');
      const messageDiv = formMessage.querySelector('div');
      if (messageDiv) {
        messageDiv.className = 'rounded-md p-4 bg-red-500/20 border border-red-500/50';
      }
      messageText.className = 'text-sm text-red-300 text-center';
      messageText.textContent = error instanceof Error ? error.message : 'Something went wrong. Please try again.';
      
      // Scroll to message
      formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } finally {
      // Re-enable submit button
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.textContent = 'Submit Residency Inquiry';
      }
      
      // Hide message after 8 seconds
      setTimeout(() => {
        formMessage?.classList.add('hidden');
      }, 8000);
    }
  });
</script>

