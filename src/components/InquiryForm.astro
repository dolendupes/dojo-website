---
// Simple inquiry form - no promises to respond
import { formspreeUrls } from '../config/formspree.js';
---

<form id="inquiry-form" action={formspreeUrls.inquiry} method="POST" class="max-w-xl mx-auto">
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
    <div>
      <label for="first-name" class="block text-sm font-medium text-white">
        First Name
      </label>
      <input
        type="text"
        name="first-name"
        id="first-name"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div>
      <label for="last-name" class="block text-sm font-medium text-white">
        Last Name
      </label>
      <input
        type="text"
        name="last-name"
        id="last-name"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="email" class="block text-sm font-medium text-white">
        Email
      </label>
      <input
        type="email"
        name="email"
        id="email"
        required
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="company" class="block text-sm font-medium text-white">
        Company / Organization (optional)
      </label>
      <input
        type="text"
        name="company"
        id="company"
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
      />
    </div>
    
    <div class="sm:col-span-2">
      <label for="interest" class="block text-sm font-medium text-white">
        What brings you to DOJO? (optional)
      </label>
      <textarea
        id="interest"
        name="interest"
        rows="3"
        class="mt-1 block w-full rounded-md bg-white/10 border-gray-600 text-white placeholder-gray-400 focus:border-dojo-red focus:ring-dojo-red"
        placeholder="Tell us about yourself and your interest in DOJO..."
      ></textarea>
    </div>
  </div>
  
  <div class="mt-6">
    <button
      type="submit"
      class="w-full bg-dojo-red text-white py-3 px-6 rounded font-semibold hover:bg-red-700 transition-colors"
    >
      Submit Inquiry
    </button>
  </div>
  
  <p class="text-sm text-dojo-light mt-4 text-center">
    We review inquiries periodically. Membership is by invitation only.
  </p>
  
  <div id="form-message" class="mt-4 hidden">
    <div class="rounded-md p-4 bg-white/10 border border-white/20">
      <p class="text-sm text-white text-center"></p>
    </div>
  </div>
</form>

<script define:vars={{ formspreeUrl: formspreeUrls.inquiry }}>
  const form = document.getElementById('inquiry-form') as HTMLFormElement;
  const formMessage = document.getElementById('form-message');
  const messageText = formMessage?.querySelector('p');
  const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;
  
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!form || !formMessage || !messageText) return;
    
    // Disable submit button to prevent double submissions
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.textContent = 'Submitting...';
    }
    
    const formData = new FormData(form);
    
    try {
      const response = await fetch(formspreeUrl, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });
      
      if (response.ok) {
        // Success
        formMessage.classList.remove('hidden');
        const messageDiv = formMessage.querySelector('div');
        if (messageDiv) {
          messageDiv.className = 'rounded-md p-4 bg-green-500/20 border border-green-500/50';
        }
        messageText.className = 'text-sm text-green-300 text-center';
        messageText.textContent = 'Thank you for your interest. Your information has been recorded.';
        
        // Reset form
        form.reset();
        
        // Scroll to message
        formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        // Error from Formspree
        const data = await response.json();
        throw new Error(data.error || 'Something went wrong. Please try again.');
      }
    } catch (error) {
      // Network error or other error
      formMessage.classList.remove('hidden');
      const messageDiv = formMessage.querySelector('div');
      if (messageDiv) {
        messageDiv.className = 'rounded-md p-4 bg-red-500/20 border border-red-500/50';
      }
      messageText.className = 'text-sm text-red-300 text-center';
      messageText.textContent = error instanceof Error ? error.message : 'Something went wrong. Please try again.';
      
      // Scroll to message
      formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } finally {
      // Re-enable submit button
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.textContent = 'Submit Inquiry';
      }
      
      // Hide message after 8 seconds (longer for errors)
      setTimeout(() => {
        formMessage?.classList.add('hidden');
      }, 8000);
    }
  });
</script>
